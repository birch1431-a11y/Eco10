<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ”„ ê¸€ë¡œë²Œ ê²½ì œ ìƒí™©íŒ</title>
    <style>
        body { background-color: #121212; color: #e0e0e0; font-family: -apple-system, sans-serif; padding: 15px; margin: 0; }
        .header { text-align: center; font-size: 1.1rem; font-weight: bold; margin-bottom: 25px; color: #c5a059; cursor: pointer; padding: 10px; border: 1px solid #444; border-radius: 8px; }
        .hr-short { border: 0; border-top: 2px solid #c5a059; width: 30px; margin: 5px 0 10px 0; }
        .category { margin-top: 25px; font-size: 0.95rem; color: #ffffff; font-weight: bold; }
        .item-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 5px; border-bottom: 1px solid #222; }
        .label { font-size: 0.95rem; color: #bbbbbb; } 
        .unit-text { font-size: 0.85rem; color: #888888; margin-left: 4px; } 
        .val-container { text-align: right; }
        .value { font-size: 1rem; font-weight: 600; font-family: 'Roboto Mono', monospace; color: #ffffff; display: block; }
        .change { font-size: 0.75rem; margin-top: 2px; }
        .up { color: #ff4444; }
        .down { color: #4488ff; }
        .status-danger { color: #ff4444 !important; }
        .status-warning { color: #ffbb33 !important; }
        .status-safe { color: #00ff88 !important; }
        .footer-copy { text-align: center; font-size: 0.7rem; color: #555; margin: 40px 0 10px 0; border-top: 1px solid #222; padding-top: 20px; }
    </style>
</head>
<body>

    <div class="header" onclick="location.reload()">ğŸ”„ ê¸€ë¡œë²Œ ê²½ì œ ìƒí™©íŒ</div>

    <div class="category">ì™¸í™˜</div><hr class="hr-short">
    <div class="item-row"><span class="label">ë‹¬ëŸ¬ì§€ìˆ˜</span><div class="val-container"><span class="value" id="DXY">--</span><div class="change" id="DXY-c">--</div></div></div>
    <div class="item-row"><span class="label">ì›/ë‹¬ëŸ¬</span><div class="val-container"><span class="value" id="USD/KRW">--</span><div class="change" id="USD/KRW-c">--</div></div></div>
    <div class="item-row"><span class="label">ì›/ì—”</span><div class="val-container"><span class="value" id="JPY/KRW">--</span><div class="change" id="JPY/KRW-c">--</div></div></div>
    <div class="item-row"><span class="label">ì›/ìœ ë¡œ</span><div class="val-container"><span class="value" id="EUR/KRW">--</span><div class="change" id="EUR/KRW-c">--</div></div></div>
    <div class="item-row"><span class="label">ì›/ìœ„ì•ˆ</span><div class="val-container"><span class="value" id="CNY/KRW">--</span><div class="change" id="CNY/KRW-c">--</div></div></div>

    <div class="category">ì£¼ìš” ì¦ì‹œì§€í‘œ</div><hr class="hr-short">
    <div class="item-row"><span class="label">ë¯¸ ì¦ì‹œ ì‹œì´<span class="unit-text">($T)</span></span><div class="val-container"><span class="value" id="US_MCAP">--</span><div class="change" id="US_MCAP-c">--</div></div></div>
    <div class="item-row"><span class="label">S&P 500</span><div class="val-container"><span class="value" id="SP500">--</span><div class="change" id="SP500-c">--</div></div></div>
    <div class="item-row"><span class="label">NASDAQ</span><div class="val-container"><span class="value" id="NASDAQ">--</span><div class="change" id="NASDAQ-c">--</div></div></div>
    <div class="item-row"><span class="label">DOW</span><div class="val-container"><span class="value" id="DOW">--</span><div class="change" id="DOW-c">--</div></div></div>
    <div class="item-row"><span class="label">í•œ ì¦ì‹œ ì‹œì´<span class="unit-text">(ì¡°â‚©)</span></span><div class="val-container"><span class="value" id="KR_MCAP">--</span><div class="change" id="KR_MCAP-c">--</div></div></div>
    <div class="item-row"><span class="label">KOSPI</span><div class="val-container"><span class="value" id="KOSPI">--</span><div class="change" id="KOSPI-c">--</div></div></div>
    <div class="item-row"><span class="label">ë‹¬ëŸ¬í™˜ì‚° KOSPI</span><div class="val-container"><span class="value" id="KOSPI_USD">--</span><div class="change" id="KOSPI_USD-c">--</div></div></div>
    <div class="item-row"><span class="label">KOSDAQ</span><div class="val-container"><span class="value" id="KOSDAQ">--</span><div class="change" id="KOSDAQ-c">--</div></div></div>

    <div class="category">ë¯¸êµ­ êµ­ì±„ ê¸ˆë¦¬</div><hr class="hr-short">
    <div class="item-row"><span class="label">30Y Yield</span><div class="val-container"><span class="value" id="US30Y">--</span><div class="change" id="US30Y-c">--</div></div></div>
    <div class="item-row"><span class="label">10Y Yield</span><div class="val-container"><span class="value" id="US10Y">--</span><div class="change" id="US10Y-c">--</div></div></div>
    <div class="item-row"><span class="label">2Y Yield</span><div class="val-container"><span class="value" id="US2Y">--</span><div class="change" id="US2Y-c">--</div></div></div>

    <div class="category">ì›ìì¬</div><hr class="hr-short">
    <div class="item-row"><span class="label">GOLD<span class="unit-text">($/oz)</span></span><div class="val-container"><span class="value" id="GOLD">--</span><div class="change" id="GOLD-c">--</div></div></div>
    <div class="item-row"><span class="label">SILVER<span class="unit-text">($/oz)</span></span><div class="val-container"><span class="value" id="SILVER">--</span><div class="change" id="SILVER-c">--</div></div></div>
    <div class="item-row"><span class="label">êµ¬ë¦¬<span class="unit-text">($/lb)</span></span><div class="val-container"><span class="value" id="COPPER">--</span><div class="change" id="COPPER-c">--</div></div></div>
    <div class="item-row"><span class="label">PLATINUM<span class="unit-text">($/oz)</span></span><div class="val-container"><span class="value" id="PLATINUM">--</span><div class="change" id="PLATINUM-c">--</div></div></div>
    <div class="item-row"><span class="label">WTIìœ <span class="unit-text">($/bbl)</span></span><div class="val-container"><span class="value" id="WTI">--</span><div class="change" id="WTI-c">--</div></div></div>

    <div class="category">ê°€ìƒìì‚°</div><hr class="hr-short">
    <div class="item-row"><span class="label">BTC<span class="unit-text">($)</span></span><div class="val-container"><span class="value" id="BTC">--</span><div class="change" id="BTC-c">--</div></div></div>
    <div class="item-row"><span class="label">ETH<span class="unit-text">($)</span></span><div class="val-container"><span class="value" id="ETH">--</span><div class="change" id="ETH-c">--</div></div></div>
    <div class="item-row"><span class="label">XRP<span class="unit-text">($)</span></span><div class="val-container"><span class="value" id="XRP">--</span><div class="change" id="XRP-c">--</div></div></div>

    <div class="category">ì‹œì¥ ì‹¬ë¦¬ ë° ë°¸ë¥˜ì—ì´ì…˜</div><hr class="hr-short">
    <div class="item-row"><span class="label">VIX ì§€ìˆ˜</span><div class="val-container"><span class="value" id="VIX">--</span><div class="change" id="VIX-c">--</div></div></div>
    <div class="item-row"><span class="label">ì¥ë‹¨ê¸° ê¸ˆë¦¬ì°¨</span><div class="val-container"><span class="value" id="SPREAD">--</span><div class="change" id="SPREAD-c">--</div></div></div>
    <div class="item-row"><span class="label">ë²„í• ì§€ìˆ˜</span><span class="value" id="BUFFETT">--</span></div>
    <div class="item-row"><span class="label">ì‰´ëŸ¬ PER</span><span class="value" id="SHILLER">--</span></div>

    <div class="footer-copy">2026 Developed by S.K. Chun</div>
    <div id="status-msg" style="text-align:center; font-size:0.7rem; color:#555; margin-bottom:30px;">ì—°ê²° ì‹œë„ ì¤‘...</div>

    <script>
        const MY_API_KEY = "7142915ec1dc45caad56dfc9fcf07341";
        const BASE_US_MCAP = 55.2; 
        const BASE_KR_MCAP = 2450; 

        let liveKospi = { cur: null, prev: null }, liveUsdKrw = { cur: null, prev: null };
        let globalRates = { "10Y": null, "2Y": null, "10Y_prev": null, "2Y_prev": null };

        async function fetchYahoo(ticker) {
            const url = `https://query1.finance.yahoo.com/v8/finance/chart/${ticker}?interval=1m&range=1d`;
            const proxies = [`https://corsproxy.io/?${encodeURIComponent(url)}`, `https://api.allorigins.win/get?url=${encodeURIComponent(url)}` ];
            
            for (let proxy of proxies) {
                try {
                    const res = await fetch(proxy);
                    const json = await res.json();
                    const data = json.contents ? JSON.parse(json.contents) : json;
                    if (data?.chart?.result) return data.chart.result[0].meta;
                } catch (e) { continue; }
            }
            return null;
        }

        async function getSmartData(type) {
            const today = new Date();
            const yearMonth = today.getFullYear() + "-" + (today.getMonth() + 1);
            let saved = JSON.parse(localStorage.getItem('smart_' + type)) || { val: (type === 'GDP' ? 27.94 : 38.1), lastChecked: "" };
            let needCheck = (type === 'GDP' && [1, 4, 7, 10].includes(today.getMonth()+1) && today.getDate() >= 30) || (type === 'SHILLER' && today.getDate() >= 7);
            
            if (needCheck && saved.lastChecked !== yearMonth) {
                const meta = await fetchYahoo(type === 'GDP' ? 'GDP' : 'CAPE');
                if (meta) {
                    saved.val = type === 'GDP' ? meta.regularMarketPrice / 1000 : meta.regularMarketPrice;
                    saved.lastChecked = yearMonth;
                    localStorage.setItem('smart_' + type, JSON.stringify(saved));
                }
            }
            return saved.val;
        }

        function updateUI(id, price, prev) {
            const el = document.getElementById(id);
            if (!el) return;

            // ê°€ê²© í‘œì‹œ
            if (id.includes("Y")) el.innerText = price.toFixed(3) + "%";
            else if (price > 1000) el.innerText = price.toLocaleString(undefined, {maximumFractionDigits:2});
            else el.innerText = price.toFixed(2);

            // ë“±ë½ í‘œì‹œ
            const diff = price - prev, percent = (diff / prev * 100).toFixed(2);
            const cls = diff > 0 ? "up" : diff < 0 ? "down" : "";
            const cEl = document.getElementById(id + "-c");
            if (cEl) cEl.innerHTML = `<span class="${cls}">${diff > 0 ? "â–²" : "â–¼"} ${Math.abs(diff).toFixed(2)} (${percent}%)</span>`;
        }

        async function loadYahooItem(ticker, id) {
            const meta = await fetchYahoo(ticker);
            if (!meta) return;

            const price = meta.regularMarketPrice, prev = meta.previousClose;
            
            if (id === "VTI_INTERNAL") {
                const curMcap = BASE_US_MCAP * (price / prev);
                updateUI("US_MCAP", curMcap, BASE_US_MCAP);
                getSmartData('GDP').then(gdp => {
                    const b = (curMcap / gdp * 100).toFixed(1);
                    const bEl = document.getElementById("BUFFETT");
                    bEl.innerText = b + "%";
                    bEl.className = "value " + (b >= 150 ? "status-danger" : b >= 120 ? "status-warning" : "status-safe");
                });
            } else {
                updateUI(id, price, prev);
            }

            if (id === "US10Y") { globalRates["10Y"] = price; globalRates["10Y_prev"] = prev; checkSpread(); }
            if (id === "US2Y") { globalRates["2Y"] = price; globalRates["2Y_prev"] = prev; checkSpread(); }
            if (id === "KOSPI") { 
                liveKospi.cur = price; liveKospi.prev = prev; 
                updateUI("KR_MCAP", BASE_KR_MCAP * (price / prev), BASE_KR_MCAP);
                checkKospiUsd();
            }
            if (id === "VIX") document.getElementById(id).className = "value " + (price >= 30 ? "status-danger" : price >= 20 ? "status-warning" : "status-safe");
        }

        function checkSpread() {
            if (globalRates["10Y"] && globalRates["2Y"]) {
                const s = globalRates["10Y"] - globalRates["2Y"], ps = globalRates["10Y_prev"] - globalRates["2Y_prev"];
                const el = document.getElementById("SPREAD");
                el.innerText = s.toFixed(3) + "%p";
                el.className = "value " + (s < 0 ? "status-danger" : "status-safe");
                updateUI("SPREAD", s, ps);
            }
        }

        function checkKospiUsd() {
            if (liveKospi.cur && liveUsdKrw.cur) {
                updateUI("KOSPI_USD", liveKospi.cur / liveUsdKrw.cur, liveKospi.prev / liveUsdKrw.prev);
            }
        }

        async function loadData() {
            const start = Date.now();
            const items = [
                ["VTI", "VTI_INTERNAL"], ["DX-Y.NYB", "DXY"], ["^GSPC", "SP500"], ["^IXIC", "NASDAQ"], ["^DJI", "DOW"],
                ["^KS11", "KOSPI"], ["^KQ11", "KOSDAQ"], ["^TYX", "US30Y"], ["^TNX", "US10Y"], ["^IRX", "US2Y"],
                ["GC=F", "GOLD"], ["SI=F", "SILVER"], ["HG=F", "COPPER"], ["PL=F", "PLATINUM"], ["CL=F", "WTI"],
                ["BTC-USD", "BTC"], ["ETH-USD", "ETH"], ["XRP-USD", "XRP"], ["^VIX", "VIX"]
            ];
            items.forEach(i => loadYahooItem(i[0], i[1]));

            const fx = ["USD/KRW", "JPY/KRW", "EUR/KRW", "CNY/KRW"];
            for (let s of fx) {
                try {
                    const d = await fetch(`https://api.twelvedata.com/quote?symbol=${s}&apikey=${MY_API_KEY}`).then(r => r.json());
                    if (d.close) {
                        const cur = parseFloat(d.close), pre = parseFloat(d.previous_close);
                        updateUI(s, cur, pre);
                        if (s === "USD/KRW") { liveUsdKrw.cur = cur; liveUsdKrw.prev = pre; checkKospiUsd(); }
                    }
                } catch(e) {}
                await new Promise(r => setTimeout(r, 500));
            }

            getSmartData('SHILLER').then(v => {
                const el = document.getElementById("SHILLER");
                el.innerText = v.toFixed(1);
                el.className = "value " + (v >= 30 ? "status-danger" : v >= 20 ? "status-warning" : "status-safe");
                document.getElementById('status-msg').innerText = `ê°±ì‹  ì™„ë£Œ: ${new Date().toLocaleTimeString()} (${((Date.now() - start) / 1000).toFixed(1)}s)`;
            });
        }
        window.onload = loadData;
    </script>
</body>
</html>
